//$FONT: "Palatino Linotype", "Book Antiqua", "Palatino", serif;
$FONT: "Courier New", monospace;

$COLOR_PAGE:  #fff;         // Background color
$COLOR_TEXT:  #000;         // Color for normal text
$COLOR_LINK:  #901;         // Color for links
$COLOR_FOCUS: #f02;         // Color for focused links
$COLOR_FRILL: #777;         // Color for quote symbols and other embellishments

$SIZE_TEXT: 12pt;           // Base font size
$SIZE_LINE: 1.8em;          // How much space a line gets
$SIZE_HEAD1: 1.8em;         // Font size for title
$SIZE_HEAD2: 1.2em;         // Font size for section header $SIZE_HEAD2;
$SIZE_HEAD3: 1.1em;         // Font size for subsection header
$SIZE_HEAD4: 1em;           // Font size for paragraph header

$WIDTH_PAGE_MIN: 35em;      // Minimum width before margin scales down
$WIDTH_PAGE_MAX: 40em;      // Maximum width before margin scales up
$WIDTH_TOC: 9em;            // Width of table of contents when moved to the side

$VSPACE_PAGE: 5em;          // Vertical margin on the page
$HSPACE_PAGE: 3em;          // Horizontal margin on the page
$HSPACE_INDEX: 3em;         // Horizontal margin around index page
$VSPACE_INDEX: 2em;         // Vertical margin around index page
$HSPACE_INDENT: 2.5em;      // Indentation for lists items and blockquotes

$VSPACE_MENU: 0.5em;        // Vertical space to avoid hugging the index link
$VSPACE_PARAGRAPH: 0.6em;   // Vertical space around paragraphs and lists
$VSPACE_FIGURE: 2.5em;      // Vertical space around figures, tables, listingsâ€¦
$VSPACE_CAPTION_BODY: .8em; // Vertical space between caption and its body
$VSPACE_CAPTION_EXTRA: .5em;// Additional space under captions

$VSPACE_ENTRY: 0.4em;       // Vertical spacing around list items

$VSPACE_HEAD1: 1.5em;       // Vertical space under title
$VSPACE_HEAD2: $VSPACE_PARAGRAPH; // Vertical space under section header
$VSPACE_HEAD3: $VSPACE_PARAGRAPH; // Vertical space under subsection header
$HSPACE_HEAD4: 1em;         // Horizontal space next to paragraph header

$VSPACE_BODY1: 4em;         // Vertical space between previous content and new title
$VSPACE_BODY2: 2em;         // Vertical space between sections
$VSPACE_BODY3: 2em;         // Vertical space between subsections

$VSPACE_HR_RESET: 2em;      // Space between <hr> or document start and a header
$VSPACE_HR: 2.5em;          // Vertical space around horizontal rules
$HSPACE_TOC: 1.5em;         // Horizontal space between ToC and page


* {
    margin: 0;
    padding: 0;
}

main, nav#index {
    margin: $VSPACE_PAGE auto;
    padding: 0 $HSPACE_PAGE;
}

/* Basic page elements *******************************************************/

body {
    color: $COLOR_TEXT;
    background-color: $COLOR_PAGE;
    font-family: $FONT;
    font-size: $SIZE_TEXT;
    text-align: justify;
    word-wrap: break-word;
    letter-spacing: 0.01em;
}

p, ul, ol {
    margin: $VSPACE_PARAGRAPH 0;
    line-height: $SIZE_LINE;
}


header {
    text-transform: uppercase;
    margin: $VSPACE_HR_RESET 0 $VSPACE_HEAD1/2;
}
h1 {
    font-style: normal;
    font-size: $SIZE_HEAD1;
    margin-top: 0.1em;
    text-align: left;
    font-weight: 300;
    text-transform: uppercase;
}
header div {
    color: $COLOR_FRILL;
    font-size: 0.8em;
    letter-spacing: 0.15em;
}
header a {
    float: right;
    margin-left: $VSPACE_MENU;
    display: inline-block;
    text-decoration: none;
    font-family: sans-serif;
    font-size: $SIZE_HEAD1;
}

h2 {
    margin: $VSPACE_BODY2 0 $VSPACE_HEAD2;
    font-size: $SIZE_HEAD2;
    font-weight: 600;
    padding-bottom: 0.5em;
    border-bottom: 3px double $COLOR_TEXT;
}
h3 {
    margin: $VSPACE_BODY3 0 $VSPACE_HEAD3;
    font-size: $SIZE_HEAD3;
    font-weight: normal;
    padding-bottom: 0.25em;
    border-bottom: 1px solid $COLOR_TEXT;
}
h4 {
    margin: 0 $HSPACE_HEAD4 0 0; 
    font-size: 1em;
    line-height: $SIZE_LINE;
    float: left;
    font-weight: 600;
}
hr + h2, hr + h3, hr + h4 {
    margin-top: $VSPACE_HR_RESET;
}
h2 + h3 {
    margin-top: 1em;
}
h4 + * { // Anything that follows a paragraph header should come underneath...
    clear: left;
}
h4 + p { // ... except paragraphs, which come inline.
    clear: none;
}

a {
    text-decoration: underline;
    color: $COLOR_LINK;
}
a:hover {
    color: $COLOR_FOCUS;
}
a.footnote-ref {
    text-decoration: none;
}
sup {
    line-height: 1em;
}


/* Lists ********************************************************************/

ul, ol {
    list-style-type: square;
}
main li {
    margin-left: $HSPACE_INDENT;
    padding-left: 0.5em;
}
li p {
    margin: 0 0 $VSPACE_ENTRY 0;
    display: inline-block;
    vertical-align: top;
}

/* Description lists ********************************************************/

$DL_SIZE: 17%; 
dl {
    margin: 0;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    width: 100%;
}
dl dt {
    flex: 0 0 $DL_SIZE;
    margin: 0.25em 0;
    text-overflow: ellipsis;
    font-weight: 600;
    overflow: hidden;
}
dl dd {
    flex: 0 0 (100%-$DL_SIZE);
    margin: 0.25em 0 0 auto;
    text-align: left;
}


/* Tables *******************************************************************/

table {
    margin: $VSPACE_FIGURE auto;
    border-collapse: collapse;
}
caption {
    font-style: italic;
    margin-top: $VSPACE_CAPTION_BODY;
    padding-bottom: $VSPACE_CAPTION_EXTRA;
    caption-side: bottom;
}
th, td {
    padding: 0.5em;
}
td:first-child {
    font-weight: bold;
}
table>tr:first-child td, caption + tr td, thead th {
    font-weight: bold;
    border-bottom: 1px solid $COLOR_TEXT;
    border-top: 1px solid $COLOR_TEXT;
}
table>tr:last-child td, tbody {
    border-bottom: 1px solid $COLOR_TEXT;
}
tr + caption {
    border-top: 1px solid $COLOR_TEXT;
}
table.no-col-header {
    td:first-child {
        font-weight: normal;
    }
}
table.no-row-header {
    > tr:first-child td, caption + tr td {
        font-weight: normal;
        border-bottom: none;
    }
}


/* Images *******************************************************************/

figure {
    margin: $VSPACE_FIGURE 0;
    text-align: center;

    img {
        display: inline-block;
        width: 100%;
        vertical-align: top; // Gets rid of space under inlined image
    }
    figcaption {
        margin-top: $VSPACE_CAPTION_BODY;
        padding-bottom: $VSPACE_CAPTION_EXTRA;
        font-style: italic;
        
        * {
            margin: 0;
        } 
    }
}


/* Separating lines *********************************************************/

hr {
    border: none;
    border-top: 1px solid $COLOR_TEXT;
    text-align: center;
    margin: $VSPACE_HR auto;
    width: 100%;
    position: relative;
}
hr::after {
    $SIZE_HR: 0.5em;
    $WIDTH_HR_INNER: 3em;
    content: "*";
    font-size: 1.2em;
    font-weight: 100;
    position: absolute;
    top: (-$SIZE_HR/2);
    left: 50%;
    margin-left: (-($WIDTH_HR_INNER+$SIZE_HR)/2);
    width: $WIDTH_HR_INNER;
    color: $COLOR_TEXT;
    background: $COLOR_PAGE;
}


/* Quotes and line blocks ***************************************************/

blockquote, .line-block {
    margin: $VSPACE_FIGURE 0 $VSPACE_FIGURE $HSPACE_INDENT;
    font-style: italic;
    quotes: "\201C""\201D""\2018""\2019";
    position: relative;

    p::before, p::after {
        font-family: "Times New Roman", serif;
        font-size: 2.5em;
        line-height: 0.05em;
        vertical-align: -0.4em;
        color: $COLOR_FRILL;
    }
    p::before {
        content: open-quote;
        padding-right: 0.4em;
    }
    p::after {
        content: close-quote;
        padding-left: 0.1em;
    }
    p {
        text-indent: 0; // avoid messing up quote symbols,
                        // should another indent value be inherited
    }
    footer {
        text-align: right;
        font-style: normal;
        position: absolute;
        right: 0;
    }
    footer::before {
        content: "~";
    }
}


/* Source code **************************************************************/

code {
    white-space: pre-wrap;
}

code pre {
    margin: $VSPACE_FIGURE 0;
}


/* Table of contents (page) *************************************************/

nav#toc {
    text-align: left;
    float: right;
    background: $COLOR_PAGE;
    padding: 0.3em 0 0.3em $HSPACE_TOC;

    ul {
        line-height: 1em;
        margin: 0;
        list-style: none; // to override unorderedness of ToC
        counter-reset: item;
        >li {
            display: block;
            margin-left: 0;
        }
        >li:before {
            content: counters(item, ".") ". ";
            counter-increment: item;
            padding-right: 0.4em;
            font-size: 0.5em;
        }
    }

    li li {
        margin-left: 1em;
    }

    a {
        font-size: 0.6em;
        text-decoration: none;
        text-transform: lowercase;
        color: $COLOR_TEXT;
    }
}




/* Table of contents (site-wide) *********************************************/

nav#index {
    text-align: left;

    > ul > li {
        margin: 2em 0;
    }

    ul {
        list-style: none;
        font-weight: 600;
    }
    ul ul {
        margin-left: 2em;
        font-weight: normal;
    }
    a, span {
        text-transform: lowercase;
    }
    span {
        cursor: default;
    }

    // Items between which a dot is placed
    ul ul li {
        display: inline;
    }
    ul ul li + li:before {
        content: "\ \2022\00a0\ ";
        font-size: 0.6em;
        color: mix($COLOR_TEXT, $COLOR_PAGE, 60%);
    }
}

/* Miscellaneous classes & overrides ****************************************/

.hide {
    display: none;
}

.right {
    clear: right;
    float: right;
}

.left {
    clear: left;
    float: left;
}

.invert {
    display: inline-block;
    -webkit-transform: matrix(-1, 0, 0, 1, 0, 0);
    -moz-transform: matrix(-1, 0, 0, 1, 0, 0);
    -o-transform: matrix(-1, 0, 0, 1, 0, 0);
    transform: matrix(-1, 0, 0, 1, 0, 0);
}

// Make sure MathJax elements are not too large
.MathJax {
    font-size: 2em !important;
}

// Annoying that pandoc puts a rule before the footnotes
section.footnotes hr {
//    display: none;
}

// Do not underline the back link in footnotes
.footnotes a:last-child {
    padding: 0 0 0 0.5em;
    text-decoration: none;
}

/* Responsiveness */

// Once the width reaches a lower limit, margins start shrinking proportionally
@media screen and (max-width: ($WIDTH_PAGE_MIN)) {
    main, nav#index {
        padding: 0 percentage($HSPACE_PAGE/($WIDTH_PAGE_MIN + 2*$HSPACE_PAGE));
    }
}

// Once the width reaches an upper limit, the additional space is taken by
// margins. I confess I don't entirely understand why the coefficient on
// $HSPACE_PAGE is set to 4 rather than 2, but the result looks better. It's
// still not an *entirely* smooth transition, though, so this needs looking
// into.
@media screen and (min-width: ($WIDTH_PAGE_MAX + 4*( $HSPACE_PAGE ) )) {
    main, nav#index {
        width: $WIDTH_PAGE_MAX;
    }
}

// If the width gets so small that it doesn't make sense to float the ToC, just
// put it normally
@media screen and (max-width: (2*($WIDTH_TOC + $HSPACE_TOC + 2*$HSPACE_PAGE))) {
    nav#toc {
        float: none;
    }
}

// If the width gets large enough to fit the ToC on the side, move it there
@media screen and (min-width: ($WIDTH_PAGE_MAX + 2*($HSPACE_PAGE*2 + $HSPACE_TOC + $WIDTH_TOC))) {
    nav#toc {
        display: inline-block;
        margin: 0 0 0 ($WIDTH_PAGE_MAX / 2 + $HSPACE_TOC);
        position: absolute; // alternative: fixed, sticky?
        //top: $VSPACE_PAGE;  // this would place it at the top of the page
        //rather than at the same height as the first line
        left: 50%;
        width: $WIDTH_TOC;

        >ul {
            position: fixed;
        }
    }
}




/* Printing *****************************************************************/

@page {
    size: A5;
    margin: 1.5cm 2cm;
    counter-increment: page;

    @bottom-right {
        content: counter(page); 
    }
}

@media print {
    .noprint {
        display: none;
    }
    .pgbrk {
        page-break-after: always;
    }

    h1, h2 { 
        page-break-before: always;
    }
    header + h2, h1 + h2 {
        page-break-before: auto; /* override page break if h2 comes immediately
                                  after bigger header */
    }
    h1, h2, h3, h4 {
        page-break-after: avoid;
    }

    body {
        margin: 0;
        font-size: ($SIZE_TEXT);
    }
    main, section {
        margin: 0;
        width: auto;
        max-width: none;
    }
}
