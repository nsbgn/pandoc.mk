#!/bin/bash

# Wrapper that leverages a `make` recipe into compiling a static website.
# The first argument is the source directory (default: current directory),
# second argument is the destination directory (default: `dist` in sourc)

MAKEDIR="$(dirname "$(readlink --canonicalize $0)")"
SRC="${1:-$PWD}"
DEST="${2:-$SRC/dist}"

# Execute twice: on the first run, the pages are created; on the second, any
# auxiliary files that were referenced in the files are generated
for TARGET in html resources; do
    make --makefile="$MAKEDIR/makefile" \
    SRC="$SRC" DEST="$DEST" MAKEDIR="$MAKEDIR" "$TARGET" || exit
done
